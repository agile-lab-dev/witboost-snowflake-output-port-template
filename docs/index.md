### Prerequisites

A Data Product should already exist in order to attach the new components to it. The component **Snowflake Storage** should exist in the Data Product.

### Component Basic Information

This section includes the basic information that any Component of Data Mesh Boost must have

- Name: Required name used for display purposes on your Data Product
- Fully Qualified Name: Output Port fully qualified name, this is optional as will be generated by the system if not given by you
- Description: A short description to help others understand what this Output Port is for.
- Domain: The Domain of the Data Product this Output Port belongs to. Be sure to choose it correctly as is a fundamental part of the Output Port and cannot be changed afterwards.
- Data Product: The Data Product this Output Port belongs to, be sure to choose the right one.
- Identifier: Unique ID for this new entity inside the domain. Don't worry to fill this field, it will be automatically filled for you.
- Development Group: Development group of this Data Product. Don't worry to fill this field, it will be automatically filled for you.
- Depends On: If you want your Output Port to depend on other components from the Data Product, you can choose this option.

  > In order for the Snowflake Output Port to create view on top of the tables, we need to add Snowflake Storage component in the **dependsOn** field.

*Example:*

| Field name              | Example value                                                                                           |
|:------------------------|:--------------------------------------------------------------------------------------------------------|
| **Name**                | Snowflake Vaccinations Output Port                                                                      |
| **Description**         | Offers insight in the COVID-19 Vaccinations                                                             |
| **Domain**              | domain:healthcare                                                                                       |
| **Data Product**        | system:healthcare.vaccinationsdp.0                                                                      |
| ***Identifier***        | Will look something like this: *marketing.healthcare.0.snowflake-vaccinations-output-port*              |
| ***Development Group*** | Might look something like this: *group:datameshplatform* Depends on the Data Product development group  |
| ***dependsOn***         | urn:dmb:cmp:healthcare:vaccinationsdp:0:snowflake-vaccinations-storage                                  |


### Provide Output Port Deployment Information

This section will tell the Output Port where to get the data from inside Snowflake

- Database: (Optional) Enter the name of the database you want to sync data into. If not specified the Domain name will be set as default value.
- Schema: (Optional) Enter the name of the default schema. If not specified the value `<DP_name>_<DP_version>` will be set as default value. (The version will be rendered without the dots)
- View name: Enter the name of the view that will be created inside the Snowflake Schema.
- Table name: Enter the name of the table used as source to create the view on top of it.

*Example:*

| Field name     | Example value           |
|:---------------|:------------------------|
| **Database**   | HEALTHCARE              |
| **Schema**     | vaccinationsdp          |
| **Table name** | vaccinations_clean      |
| **View name**  | vaccinations_clean_view |

  > If you were to use DBT Transformation as the means to transform the data, you need to change the name of the view in the specific from vaccinations_clean_view to the name of the model that you have created in the DBT Component. This is to ensure that you can provide the access to Output Port(s).


### Provide Information about Schema

The information that needs to be filled here is explained below:

- Column Name: Name of the column inside the table.
- Column Data Type: Data Type of the column.
- Constraint: Type of constraint that can be defined on the column.
- Column Data Length: Length of a string / binary value. For strings, the length is the number of characters.
- Column Precision: Total number of digits allowed (in case of **NUMERIC** Data Type). Minimum allowed precision is 1.
- Column Scale: Number of digits allowed to the right of the decimal point (in case of **NUMERIC** Data Type). Minimum allowed scale is 0.

Below are the list of data types that are currently supported and are widely used in our use-case. They are -

- TEXT
- NUMBER
- DATE
- BOOLEAN

If any need arises in the future to expand the current list of data types, we can do so comfortably.

*Example:*

| Name                                    | Data Type | Constraint  | Data Length | Precision | Scale |
|:----------------------------------------|:----------|:------------|:------------|:----------|:------|
| _date_                                  | DATE      | PRIMARY_KEY | -           | -         | -     |
| _location_key_                          | TEXT      | PRIMARY_KEY | -           | -         | -     |
| _new_persons_vaccinated_                | NUMBER    | -           | -           | -         | -     |
| _new_persons_fully_vaccinated_          | NUMBER    | -           | -           | -         | -     |
| _new_vaccine_doses_administered_        | NUMBER    | -           | -           | -         | -     |
| _cumulative_persons_vaccinated_         | NUMBER    | -           | -           | -         | -     |
| _cumulative_persons_fully_vaccinated_   | NUMBER    | -           | -           | -         | -     |
| _cumulative_vaccine_doses_administered_ | NUMBER    | -           | -           | -         | -     |

If multiple columns are marked as `PRIMARY_KEY`, a composite primary key will be created.

After this step, the system will show you the summary of the information provided. You can go back and edit them if you notice any mistake, otherwise you can go ahead and create the Component.

After clicking on **"Create"**, the Component registration will start. If no errors occur, it will go through the 3 phases (Fetching, Publishing and Registering) and it will show you the links to the newly created repository inside GitLab and the new Data Product Component in the Builder Catalog.

  > Since the tables and views are created at deployment time and not at running time, remember to **always** add here all the tables you will use in the data transformation stages (SQL or dbt), and in the Output Port.

The deployment of this component will create a Snowflake View inside the specified Database and Schema.

After creating this component, we have several options: we can create multiple tables either with the Storage component or the SQL Workload (with a dedicated query inside the sql file). As a result, we can use one of these tables (or multiple tables) already provided by one of these components (or multiple components) to create our view on top of it(/them). Of course, in that case we need to specify the proper dependencies by adding the involved components inside the **Depends On** section of this component and change the input data accordingly, otherwise the Data Product deployment will not work as expected.

#### Custom View

The user, as already mentioned, has also the possibility to create a custom view based on different/multiple tables. In addition, you can leverage the features offered by the View to apply **masking and row access policies**. In that case, the features explained until now will not do the job, and you may need a custom view.

To create a custom view, you simply need to provide the query needed to create it by manually editing the `catalog-info.yaml` file. In particular, you need to add it in a new `customView` field inside the `specific` section of the `catalog-info.yaml` file, as showed below:

  > Be aware that we had followed certain rules for naming the specifics inside the catalog-info file (For example - Added suffixes for schemaName and appended it with majorVersion) regardless of the value being a default one (or) a custom one. During any point of time, if you have any doubts regarding these names, please refer to the catalog-info file of [**Snowflake Storage**](https://github.com/agile-lab-dev/witboost-snowflake-storage-area-template) as this would be the single source of truth.


```yaml
  components:
    - id: domain:healthcare.vaccinationsdp.0.snowflake-output-port
      name: vaccinationsdp
      fullyQualifiedName: Vaccinations Data
      description: Vaccinations Data
      kind: outputport
      owners:
        - group:bigdata
      infrastructureTemplateId: urn:dmb:itm:snowflake-outputport-provisioner:0
      useCaseTemplateId: urn:dmb:utm:snowflake-outputport-template:0.0.0
      dependsOn: [ ]
      platform: Snowflake
      technology: Snowflake
      dataContract:
        schema:
          - name: date
            dataType: DATE
          - name: location_key
            dataType: TEXT
          - name: new_persons_vaccinated
            dataType: NUMBER
          - name: new_persons_fully_vaccinated
            dataType: NUMBER
          - name: new_vaccine_doses_administered
            dataType: NUMBER
          - name: cumulative_persons_vaccinated
            dataType: NUMBER
          - name: cumulative_persons_fully_vaccinated
            dataType: NUMBER
          - name: cumulative_vaccine_doses_administered
            dataType: NUMBER
      tags: [ ]
      specific:
        viewName: vaccinations_clean_view
        tableName: vaccinations_clean
        database: HEALTHCARE
        schema: VACCINATIONSDP_0
        customView: CREATE VIEW IF NOT EXISTS HEALTHCARE.VACCINATIONSDP_0.vaccinations_clean_view AS (SELECT * FROM HEALTHCARE.VACCINATIONSDP_0.vaccinations_clean);
```

**Please note that when providing a customView query, the source tableName and the dataContract schema specified will be not used to create the View, but those parts must be aligned and compiled because the platform will check their consistency through policies.**