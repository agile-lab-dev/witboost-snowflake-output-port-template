### Prerequisites

A Data Product should already exist in order to attach the new components to it. The component **Snowflake Storage** should exist in the Data Product.

### Creation Wizard

The Creation Wizard allows you to create a new Snowflake Output Port.

#### Component metadata

This section covers the basic information that any component must have.

- Name: Required. The name of the component.
- Fully Qualified Name: Fully qualified name of the component.
- Description: Required. Help others understand what this component is for. What data will it expose?
- Domain: Required. Domain of the Data Product this component belongs to. Be sure to choose it correctly as otherwise you won't find your Data Product below.
- Data Product: Required. Data Product this component belongs to. Be sure to choose the right one as it cannot be changed.
- Identifier: Autogenerated from the information above. A unique identifier for the component. It will not be editable after creation and is a string composed of [a-zA-Z] separated by any of [-_].
- Development Group: Automatically selected from the Data Product metadata. Data Product development group.
- Depends On: A component could depend on other components in the same Data Product. This information will be used to deploy the components in such an order that their dependencies already exist.
- Tags: Tags for the component.

  > In order for the Snowflake Output Port to create the view on top of the tables, the tables have to exist already; as such, we need to add Snowflake Storage Area that we will pull data from in the **Depends On** field.

*Example:*

| Field name              | Example value                                                                                                                                                                      |
|:------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Name**                | Snowflake Vaccinations Output Port                                                                                                                                                 |
| **Description**         | Offers insight in the COVID-19 Vaccinations                                                                                                                                        |
| **Domain**              | domain:healthcare                                                                                                                                                                  |
| **Data Product**        | system:healthcare.vaccinationsdp.0                                                                                                                                                 |
| ***Identifier***        | Will look something like this: *healthcare.vaccinationsdp.0.snowflake-vaccinations-output-port*. Depends on the name you gave to the component and the data product it belongs to. |
| ***Development Group*** | Will look something like this: *group:datameshplatform*. Depends on the Data Product development group.                                                                            |
| ***Depends On***        | urn:dmb:cmp:healthcare:vaccinationsdp:0:snowflake-vaccinations-storage                                                                                                             |

#### Terms and Conditions & SLA

Specify Terms & Conditions and Service Level Agreement information for this Output Port.

- Terms and Conditions: Required. Terms and Conditions that apply to the data exposed by the Output Port that need to be met by the consumers.
- Interval of change: Required. How often the data is refreshed.
- Timeliness: Required. Timeliness of the data.
- Timeliness: Required. Uptime of the Output Port as a percentage.

*Example:*

| Field name               | Example value                        |
|:-------------------------|:-------------------------------------|
| **Terms and Conditions** | Can be used for production purposes. |
| **Interval of change**   | 2BD                                  |
| **Timeliness**           | 2BD                                  |
| **Uptime**               | 99.9%                                |


#### Data Sharing Agreement

Specify the Data Sharing Agreement clauses for this Data product.

- Purpose: Required. Purpose of the data.
- Billing: Required. Billing applied to data usage, ie how consumers are charged (if they are).
- Security: Required. Security policies that apply to the data.
- Intended Usage: Required. Intended usage for the data.
- Limitations: Required. Limitations of the data.
- Lifecycle: Required. Lifecycle of the data.
- Confidentiality: Required. Confidentiality of the data.

*Example:*

| Field name      | Example value                                                                       |
|:----------------|:------------------------------------------------------------------------------------|
| Purpose         | Foundational data for downstream sue cases.                                         |
| Billing         | None.                                                                               |
| Security        | Platform standard security policies.                                                |
| Intended Usage  | Any downstream use cases.                                                           |
| Limitations     | Needs joining with other datasets (eg customer data) for most analytical use cases. |
| Lifecycle       | Data loaded every two days and typically never deleted.                             |
| Confidentiality | None.                                                                               |


#### Snowflake deployment Information

This section covers specific information related to where the Output Port reads data from and where it is located on Snowflake.

- Storage Area: Required. An Output Port has to get data from a Storage Area in the same Data Product.
- Table Name: Required. Choose a table from the ones defined by the Storage Area above. This is where the Output Port view will get its data from.
- Database: Name of the database in Snowflake. If not provided, the default value (In this case, domain name) will be assigned during the creation.
- Schema: Name of the schema inside the Snowflake database specified above. If not provided, the default value (In this case, dpname_dpversion) will be assigned during the creation.
- View name: Required. Name of the view that will be created inside the Snowflake schema specified above.

*Example:*

| Field name       | Example value           |
|:-----------------|:------------------------|
| **Storage Area** | Snowflake Storage Area  |
| **Table Name**   | vaccinations_clean      |
| **Database**     | HEALTHCARE              |
| **Schema**       | vaccinationsdp          |
| **View name**    | vaccinations_clean_view |

#### Schema

The schema for the Output Port, ie the columns of the view.

- Name: Required. Name of the column inside the view.
- Description: Description for the column.
- Data Type: Required. Data Type of the column.
- Constraint: Type of constraint defined on the column.
- Length: Length of a TEXT column, ie the maximum number of characters.
- Precision: Total number of digits allowed (in case of **NUMERIC** Data Type). Minimum allowed precision is 1.
- Scale: Number of digits allowed to the right of the decimal point (in case of **NUMERIC** Data Type). Minimum allowed scale is 0.
- Business Terms: Pick any number of Business Terms to apply to the column as tags.
- PII: Check the box to mark the column as PII-relevant with a tag.

Below are the list of data types that are currently supported and are widely used in our use-case:

- TEXT
- NUMBER
- DATE
- BOOLEAN

If any need arises in the future to expand the current list of data types, we can do so comfortably.

*Example:*

| Name                                    | Data Type | Constraint  | Length.  | Precision | Scale |
|:----------------------------------------|:----------|:------------|:---------|:----------|:------|
| _date_                                  | DATE      | PRIMARY_KEY | -        | -         | -     |
| _location_key_                          | TEXT      | PRIMARY_KEY | 16777216 | -         | -     |
| _new_persons_vaccinated_                | NUMBER    | -           | -        | 38        | 0     |
| _new_persons_fully_vaccinated_          | NUMBER    | -           | -        | 38        | 0     |
| _new_vaccine_doses_administered_        | NUMBER    | -           | -        | 38        | 0     |
| _cumulative_persons_vaccinated_         | NUMBER    | -           | -        | 38        | 0     |
| _cumulative_persons_fully_vaccinated_   | NUMBER    | -           | -        | 38        | 0     |
| _cumulative_vaccine_doses_administered_ | NUMBER    | -           | -        | 38        | 0     |

If multiple columns are marked as `PRIMARY_KEY`, a composite primary key will be created.

#### Creation

After this step, the system will show you the summary of the information provided. You can go back and edit them if you notice any mistake, otherwise you can go ahead and create the component.

After clicking on **"Create"**, the component registration will start. If no errors occur, it will go through the 3 phases (Fetching, Publishing and Registering) and it will show you the links to the newly created repository inside GitLab and the new Data Product component in the Builder Catalog.

When deploying the Data Product, deployment of this component will create the Snowflake view inside the specified database and schema.

### Custom View

The user, as already mentioned, has also the possibility to create a custom view based on different/multiple tables. In addition, you can leverage the features offered by the view to apply **masking and row access policies**. In that case, the features explained until now will not do the job, and you may need a custom view.

To create a custom view, you simply need to provide the query needed to create it by manually editing the `catalog-info.yaml` file. In particular, you need to add it in a new `customView` field inside the `specific` section of the `catalog-info.yaml` file, as showed below:

  > Be aware that we had followed certain rules for naming the specifics inside the catalog-info file (For example - Added suffixes for schemaName and appended it with majorVersion) regardless of the value being a default one (or) a custom one. During any point of time, if you have any doubts regarding these names, please refer to the catalog-info file of [**Snowflake Storage**](https://github.com/agile-lab-dev/witboost-snowflake-storage-area-template) as this would be the single source of truth.


```yaml
  components:
    - id: domain:healthcare.vaccinationsdp.0.snowflake-output-port
      name: vaccinationsdp
      fullyQualifiedName: Vaccinations Data
      description: Vaccinations Data
      kind: outputport
      owners:
        - group:bigdata
      infrastructureTemplateId: urn:dmb:itm:snowflake-outputport-provisioner:0
      useCaseTemplateId: urn:dmb:utm:snowflake-outputport-template:0.0.0
      dependsOn: [ ]
      platform: Snowflake
      technology: Snowflake
      dataContract:
        schema:
          - name: date
            dataType: DATE
          - name: location_key
            dataType: TEXT
          - name: new_persons_vaccinated
            dataType: NUMBER
          - name: new_persons_fully_vaccinated
            dataType: NUMBER
          - name: new_vaccine_doses_administered
            dataType: NUMBER
          - name: cumulative_persons_vaccinated
            dataType: NUMBER
          - name: cumulative_persons_fully_vaccinated
            dataType: NUMBER
          - name: cumulative_vaccine_doses_administered
            dataType: NUMBER
      tags: [ ]
      specific:
        viewName: vaccinations_clean_view
        tableName: vaccinations_clean
        database: HEALTHCARE
        schema: VACCINATIONSDP_0
        customView: CREATE VIEW IF NOT EXISTS HEALTHCARE.VACCINATIONSDP_0.vaccinations_clean_view AS (SELECT * FROM HEALTHCARE.VACCINATIONSDP_0.vaccinations_clean);
```

**Please note that when providing a customView query, the source tableName and the dataContract schema specified will be not used to create the view, but those parts must be aligned and match with the schema produced by your custom query because the platform will check their consistency through policies.**

### Edit Wizard

The Edit Wizard allows you to edit most information about the component after you have created it. The sections are the same as the Creation Wizard, so you can refer to the documentation above, but some fields will be locked as they cannot be changed after creation.